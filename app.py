import base64
from io import BytesIO

from flask import Flask, render_template, redirect, url_for, make_response, jsonify
from flask import request
from flask_wtf import FlaskForm
from wtforms import widgets, SelectMultipleField

from database import Database

SECRET_KEY = 'development'
app = Flask(__name__)
app.config.from_object(__name__)

table_idx = 0

BD = Database(csv_file='dynamic_no_fibr.csv')


def serve_pil_image(pil_img):
    img_io = BytesIO()
    pil_img.save(img_io, 'JPEG')
    img_io.seek(0)
    return img_io

class MultiCheckboxField(SelectMultipleField):
    widget = widgets.ListWidget(prefix_label=False)
    option_widget = widgets.CheckboxInput()


class SimpleForm(FlaskForm):

    # create a list of value/description tuples
    rhythm = [(x, x) for x in ('Синусовая Тахикардия',
                               'Синусовая брадикардия',
                               'Синусовая аритмия',
                               'Экстасистолия',
                               'ФП',
                               'Трепетание Предсердий',
                               'Трепетание желудочков',
                               'Фибр желудочков')
              ]
    #rhythm = [(x, x) for x in list_of_files]
    norma = MultiCheckboxField('Normal', choices=[('norm', 'Нормальный(синусовый) ритм')])
    rhythm = MultiCheckboxField('Rhythm', choices=rhythm)
    blocks = MultiCheckboxField('Blocks', choices=[('Блокада', 'Блокада')])
    hypertrophy = MultiCheckboxField('Hypertrophy', choices=[('Гипертрофия', 'Гипертрофия')])
    skip = MultiCheckboxField('Blocks', choices=[('Без заключения', 'Без заключения')])

@app.route('/',methods=['post','get'])
def hello_world():

    global table_idx
    form = SimpleForm()
    total = BD.getTotal()
    if form.validate_on_submit():
        print(form.data)
        # return render_template("success.html", norma=form.norma.data, rhythm=form.rhythm.data, blocks=form.blocks.data)
        BD.send(table_idx, form.data)
        return redirect(url_for('hello_world'))
    else:
        print("Validation Failed")
        print(form.errors)
        table_idx, diagnosis, img, data = BD.getNext()
        # img = serve_pil_image(img)
        b64 = base64.b64encode(img.getvalue()).decode()
        info = f'Обработано {table_idx} / {total} или {round(table_idx / total * 100, 2)} процентов'
    print(table_idx, diagnosis)
    return render_template('index.html',diagnosis=diagnosis, form=form, info=info, image = b64, data=data.tolist())


@app.route('/getlist', methods=['get'])
def getlist():
    data = [{
        "id": 1,
        "title": "The Shawshank Redemption",
        "year": "1994",
        "votes": "678,79",
        "rating": "9,2",
        "rank": "1"
    }, {"id": 2, "title": "The Godfather", "year": "1972", "votes": "511,495", "rating": "9,2", "rank": "2"}, {
        "id": 3,
        "title": "The Godfather: Part II",
        "year": "1974",
        "votes": "319,352",
        "rating": "9",
        "rank": "3"
    }, {
        "id": 4,
        "title": "The Good, the Bad and the Ugly",
        "year": "1966",
        "votes": "213,03",
        "rating": "8,9",
        "rank": "4"
    }, {"id": 5, "title": "My Fair Lady", "year": "1964", "votes": "533,848", "rating": "8,9", "rank": "5"}, {
        "id": 6,
        "title": "12 Angry Men",
        "year": "1957",
        "votes": "164,558",
        "rating": "8,9",
        "rank": "6"
    }, {
        "id": 7,
        "title": "Schindler's List",
        "year": "1993",
        "votes": "355,638",
        "rating": "8,9",
        "rank": "7"
    }, {
        "id": 8,
        "title": "One Flew Over the Cuckoo's Nest",
        "year": "1975",
        "votes": "283,176",
        "rating": "8,8",
        "rank": "8"
    }, {
        "id": 9,
        "title": "The Dark Knight",
        "year": "2008",
        "votes": "612,37",
        "rating": "8,8",
        "rank": "9"
    }, {
        "id": 10,
        "title": "The Lord of the Rings: The Return of the King",
        "year": "2003",
        "votes": "472,843",
        "rating": "8,8",
        "rank": "10"
    }, {
        "id": 11,
        "title": "Star Wars: Episode V - The Empire Strikes Back",
        "year": "1980",
        "votes": "348,012",
        "rating": "8,8",
        "rank": "11"
    }, {"id": 12, "title": "Inception", "year": "2010", "votes": "458,693", "rating": "8,8", "rank": "12"}, {
        "id": 13,
        "title": "Fight Club",
        "year": "1999",
        "votes": "507,723",
        "rating": "8,8",
        "rank": "13"
    }]
    return make_response(jsonify(data), 200)

@app.route('/leads/<int:index>', methods=['get'])
def getleads(index):
    import random
    data = [115, 87, 71, 78, 71, 37, 29, 61, 74, 58, 57, 91, 135, 153, 122, 64, 36, 50, 59, 38, 25, 49, 81, 88, 61, 15, 5, 32, 42, 37, 61, 87, 77, 68, 77, 59, 35, 49, 60, 36, 24, 34, 25, 10, 16, 20, 19, 36, 46, 32, 28, 38, 27, 8, 18, 34, 27, 23, 34, 25, 5, 19, 47, 56, 61, 59, 41, 25, 14, -14, -27, 3, 41, 38, 8, -4, 12, 32, 29, 11, 17, 25, -11, -41, -4, 49, 69, 95, 110, 67, 31, 44, 48, 29, 34, 49, 47, 55, 66, 49, 34, 40, 25, -6, -5, 29, 64, 80, 70, 61, 74, 78, 67, 74, 79, 49, 26, 53, 73, 36, 0, 2, -1, 4, 59, 112, 102, 64, 42, 50, 77, 86, 59, 43, 56, 54, 30, 30, 53, 67, 70, 75, 96, 137, 163, 148, 127, 136, 147, 136, 130, 141, 145, 157, 181, 163, 108, 99, 125, 119, 111, 142, 172, 182, 185, 167, 146, 143, 120, 78, 70, 91, 95, 72, 45, 35, 38, 32, 3, -17, 7, 31, 11, 0, 25, 37, 26, 32, 47, 33, 18, 41, 70, 71, 59, 50, 55, 73, 87, 83, 63, 25, -17, -19, 14, 22, -4, -12, -3, -5, -6, 8, 15, 8, -11, -38, -43, -14, 9, 19, 49, 84, 92, 123, 236, 386, 512, 611, 709, 842, 1029, 1182, 1191, 1116, 1058, 992, 881, 716, 498, 311, 215, 167, 121, 84, 59, 49, 61, 64, 18, -40, -60, -51, -32, 7, 48, 50, 11, -16, -5, 14, 18, 22, 31, 16, -36, -88, -82, -32, -4, 11, 47, 63, 42, 48, 89, 102, 84, 75, 63, 31, 10, 3, -2, 9, 21, -13, -55, -28, 14, -4, -21, 23, 62, 54, 26, -16, -70, -85, -36, 16, 10, -27, -36, -11, 11, 9, -10, -14, 22, 76, 85, 22, -46, -35, 20, 35, 19, 26, 29, -7, -23, 19, 40, 0, -43, -58, -49, -5, 41, 35, 7, -4, -12, -19, -18, -30, -34, 3, 21, -26, -53, -20, -17, -65, -86, -62, -34, -7, 9, -2, -21, -30, -46, -48, -13, 6, -11, -8, 20, 12, -23, -34, -25, -34, -59, -64, -32, 9, 20, 2, -11, -12, -21, -3, 65, 101, 72, 64, 80, 32, -41, -32, 30, 52, 37, 33, 37, 38, 38, 40, 59, 88, 90, 82, 84, 66, 29, 15, 12, 0, 11, 39, 38, 35, 66, 78, 42, 2, -14, 1, 38, 41, 4, 8, 32, 8, -6, 40, 68, 43, 29, 33, 18, 14, 43, 61, 44, 27, 27, 29, 34, 26, -11, -20, 23, 45, 6, -32, -26, -16, -28, -19, 11, 19, 12, 23, 38, 26, -5, -16, 11, 28, -3, -20, 14, 30, 7, 11, 29, 7, -5, 22, 23, -6, -11, 4, 17, 25, 20, 4, 4, 15, 5, -11, 4, 23, 10, -3, 10, 5, -22, -21, 4, 12, 14, 28, 30, 17, 17, 25, 23, 21, 34, 51, 49, 25, 6, 2, -6, -8, 29, 63, 28, -25, -10, 25, 26, 39, 65, 48, 19, 25, 31, 6, -19, -19, 15, 69, 85, 54, 40, 61, 70, 64, 79, 96, 82, 61, 59, 74, 100, 115, 105, 97, 112, 128, 129, 133, 131, 119, 128, 148, 126, 87, 93, 104, 86, 78, 74, 42, 28, 55, 50, -15, -56, -25, 20, 30, 14, -2, 4, 10, -19, -51, -47, -40, -52, -49, -21, 0, 6, 4, -7, -10, 1, 6, 4, 13, 28, 34, 21, -12, -32, -10, 13, -33, -102, -91, -27, -5, -19, -19, -7, -2, -17, -59, -88, -53, -10, -36, -66, -11, 70, 110, 161, 265, 397, 553, 729, 881, 994, 1088, 1145, 1160, 1121, 989, 798, 615, 421, 218, 96, 53, 5, -35, -30, -15, -28, -47, -48, -36, -33, -57, -90, -90, -62, -44, -31, -8, -6, -42, -61, -46, -55, -88, -85, -70, -83, -78, -61, -91, -113, -72, -42, -52, -40, -16, -35, -63, -55, -36, -36, -39, -31, -20, -7, -7, -30, -54, -65, -72, -65, -40, -22, -28, -52, -80, -91, -83, -81, -97, -85, -38, -25, -54, -66, -51, -46, -62, -74, -48, -1, 4, -45, -82, -61, -37, -51, -60, -31, 0, 9, 2, -19, -43, -54, -52, -34, -8, 2, -5, -13, -39, -76, -66, -21, -33, -101, -131, -118, -110, -90, -58, -69, -105, -102, -91, -123, -137, -107, -113, -140, -96, -33, -47, -85, -96, -111, -124, -106, -81, -70, -51, -32, -34, -46, -68, -85, -75, -65, -72, -35, 39, 50, -15, -53, -29, -17, -39, -55, -61, -63, -55, -58, -63, -27, 12, -9, -40, -29, -15, -11, 7, -1, -42, -39, -2, 5, 17, 47, 26, -26, -24, 3, -16, -42, -23, 0, -12, -41, -61, -47, 4, 40, 34, 33, 45, 16, -55, -114, -119, -71, -14, -7, -43, -54, -37, -48, -77, -78, -65, -67, -78, -73, -43, -22, -52, -103, -111, -92, -92, -84, -55, -53, -74, -61, -36, -53, -74, -50, -15, -3, -15, -59, -105, -98, -64, -50, -44, -33, -42, -56, -43, -24, -18, -24, -50, -65, -40, -21, -49, -75, -62, -47, -47, -39, -22, 1, 12, -24, -84, -89, -35, -7, -22, -21, -1, 0, -4, 7, 12, -2, -14, -10, -8, -14, -29, -48, -45, -30, -34, -42, -27, -18, -18, -12, -26, -57, -49, -5, 15, -4, -28, -43, -45, -38, -43, -58, -53, -30, -8, 9, 18, 3, -25, -24, -6, 6, 34, 56, 39, 33, 65, 77, 56, 51, 50, 16, 0, 39, 57, 29, 30, 65, 71, 43, 23, 33, 60, 78, 73, 72, 82, 57, 1, -36, -58, -93, -102, -53, -11, -20, -27, -16, -26, -45, -45, -40, -61, -100, -121, -94, -45, -29, -48, -50, -34, -40, -62, -70, -59, -44, -45, -63, -74, -73, -73, -52, -13, -17, -71, -97, -66, -38, -48, -60, -69, -98, -132, -133, -102, -69, -53, -52, -33, 33, 112, 173, 251, 374, 512, 640, 791, 970, 1086, 1071, 989, 922, 870, 790, 633, 415, 221, 94, 12, -29, -33, -49, -100, -138, -124, -85, -67, -93, -122, -111, -87, -87, -83, -55, -43, -56, -58, -49, -50, -58, -64, -57, -25, 4, -15, -58, -73, -66, -67, -81, -88, -72, -55, -64, -83, -74, -56, -67, -65, -37, -48, -83, -70, -38, -44, -56, -30, 1, -2, -21, -33, -53, -84, -103, -97, -82, -71, -75, -69, -30, -6, -19, -5, 16, -42, -106, -65, 0, -11, -51, -57, -53, -48, -31, -32, -65, -90, -74, -26, -8, -55, -99, -78, -37, -41, -65, -60, -39, -32, -30, -29, -42, -50, -43, -45, -56, -45, -24, -18, -22, -45, -87, -94, -63, -52, -55, -45, -59, -106, -118, -78, -56, -53, -40, -58, -100, -101, -83, -106, -129, -94, -37, -6, -1, -4, 3, 15, 2, -22, -32, -39, -35, -11, -3, -24, -28, -1, 13, 8, 15, 20, 18, 29, 25, -18, -43, -16, 1, -15, 1, 44, 39, 6, -6, -10, -8, 4, 2, 14, 71, 95, 36, -24, -35, -27, -17, 0, 15, 25, 36, 48, 44, 14, -27, -39, -4, 32, 24, 7, 16, 14, -23, -28, 10, 1, -63, -85, -54, -28, -10, -3, -21, -16, 27, 34, -12, -33, -15, -12, -29, -42, -46, -31, -6, -6, -22, -4, 23, -5, -48, -37, 3, 8, -28, -73, -93, -67, -12, 30, 40, 23, -7, -19, 1, 17, 14, 18, 17, -2, -16, -29, -49, -34, 10, 20, 1, 10, 26, 12, -9, -18, -23, -9, 15, 14, 8, 22, 13, -40, -79, -72, -50, -22, 9, -2, -34, -10, 30, 10, -21, -14, 2, 8, 15, 17, 24, 45, 53, 41, 46, 62, 44, 9, 21, 56, 47, 17, 29, 67, 78, 53, 32, 34, 37, 34, 54, 96, 106, 73, 43, 11, -23, 0, 71, 115, 113, 101, 92, 93, 113, 127, 108, 89, 95, 93, 68, 57, 59, 37, -9, -39, -37, -19, -6, -3, 16, 44, 27, -30, -42, -15, -45, -107, -99, -50, -32, -36, -38, -38, -27, -19, -32, -35, -8, 12, -5, -45, -75, -70, -38, -24, -47, -61, -36, -11, -3, 12, 24, 16, 6, -2, -18, -41, -64, -70, -47, -19, -30, -51, -11, 67, 122, 201, 343, 471, 579, 740, 916, 1028, 1063, 1043, 986, 906, 806, 668, 490, 302, 128, 4, -19, 15, -5, -52, -28, 32, 41, 9, -1, 17, 12, -34, -75, -83, -85, -98, -99, -87, -82, -85, -82, -82, -90, -90, -85, -89, -94, -84, -68, -56, -51, -62, -86, -88, -61, -36, -29, -38, -60, -72, -50, -24, -23, -14, 11, 17, -1, -13, -12, -8, 0, -10, -69, -136, -136, -87, -63, -64, -63, -67, -71, -68, -82, -96, -81, -69, -55, -9, 6, -52, -94, -72, -57, -79, -86, -66, -60, -71, -77, -62, -30, -6, -27, -69, -62, -14, 5, -13, -31, -41, -53, -61, -84, -128, -166, -184, -170, -119, -89, -114, -141, -125, -86, -57, -45, -71, -122, -135, -97, -64, -66, -97, -134, -134, -110, -116, -120, -77, -35, -49, -97, -135, -140, -93, -39, -55, -85, -20, 67, 39, -52, -89, -80, -72, -65, -56, -51, -43, -42, -58, -59, -36, -23, -13, 15, 17, -23, -41, -26, -10, 17, 36, 9, -20, -2, 18, 5, -1, 20, 21, -6, -22, -24, -20, -12, -28, -53, -50, -41, -55, -69, -68, -70, -79, -74, -57, -35, -19, -23, -35, -37, -46, -70, -70, -39, -18, -23, -24, -8, -5, -25, -40, -52, -79, -92, -76, -43, -12, -16, -58, -65, -18, 10, -2, -10, -18, -51, -84, -101, -113, -125, -125, -99, -51, -12, -8, -20, -32, -51, -74, -71, -41, -31, -51, -61, -64, -74, -67, -39, -21, -9, 15, 17, -12, -22, -7, -9, -33, -60, -79, -79, -56, -32, -18, -23, -65, -101, -77, -40, -39, -37, -30, -43, -51, -18, 11, -9, -50, -61, -52, -61, -85, -81, -41, -12, -9, -7, 10, 26, 30, 29, 1, -56, -75, -37, -8, -9, -1, 3, -24, -39, -19, 0, 11, 22, 25, 24, 28, 40, 66, 90, 78, 52, 67, 106, 98, 39, 13, 52, 99, 113, 113, 111, 115, 126, 107, 57, 40, 67, 61, 12, -24, -27, -13, 2, -3, -10, -4, -17, -51, -52, -24, -29, -47, -41, -50, -66, -41, 0, 15, 11, -17, -63, -88, -69, -35, -39, -60, -49, -41, -84, -124, -103, -66, -55, -53, -61, -86, -105, -98, -50, 15, 32, -8, -43, -50, -58, -75, -103, -136, -128, -77, -48, -46, -17, 46, 118, 205, 309, 433, 580, 717, 840, 980, 1096, 1121, 1077, 1012, 920, 782, 599, 392, 212, 98, 33, -9, -36, -51, -67, -71, -39, -11, -36, -81, -89, -84, -87, -69, -42, -46, -70, -81, -87, -96, -95, -74, -45, -29, -48, -78, -71, -46, -62, -88, -72, -55, -74, -71, -37, -38, -70, -96, -129, -149, -115, -85, -103, -102, -69, -60, -68, -59, -55, -61, -59, -51, -41, -33, -50, -88, -112, -111, -104, -78, -32, -16, -33, -23, -14, -42, -55, -31, -37, -77, -93, -90, -114, -142, -129, -77, -25, -24, -75, -102, -60, -11, -15, -35, -28, -32, -64, -88, -93, -90, -82, -86, -111, -119, -94, -73, -73, -85, -98, -105, -101, -96, -93, -67, -22, -7, -30, -63, -86, -93, -117, -170, -182, -131, -117, -165, -171, -121, -108, -109, -56, -18, -48, -78, -81, -90, -89, -71, -69, -75, -69, -58, -55, -53, -54, -71, -81, -60, -20, 22, 32, -8, -33, 6, 36, 1, -33, -30, -41, -47, -21, -4, -9, 1, 26, 43, 61, 68, 33, 1, 24, 37, -6, -30, -8, -8, -30, -33, -28, -23, 0, 15, -3, -23, -25, -29, -40, -50, -56, -31, 24, 62, 69, 43, -24, -82, -55, -10, -59, -121, -82, -27, -47, -74, -58, -52, -63, -64, -71, -75, -45, -13, -15, -20, -10, -13, -21, -12, -28, -76, -89, -57, -34, -28, -36, -55, -50, -17, 0, -12, -32, -57, -68, -44, -12, -18, -40, -42, -45, -57, -43, -22, -22, 3, 46, 27, -27, -38, -26, -25, -15, -11, -55, -91, -55, 3, 28, 35, 29, 7, -6, 0, 7, 20, 34, 29, 12, -5, -25, -37, -46, -69, -76, -38, 7, 24, 20, 13, 10, 24, 48, 52, 48, 38, -11, -57, -36, 16, 28, 11, 0, -11, -31, -30, -1, 23, 43, 69, 75, 71, 89, 105, 95, 95, 93, 62, 40, 51, 75, 99, 106, 83, 59, 61, 78, 87, 81, 90, 130, 164, 159, 128, 89, 41, 1, -11, -3, -9, -39, -52, -31, -35, -69, -57, -2, 12, -27, -60, -55, -23, -2, -24, -51, -45, -35, -30, -1, 7, -42, -70, -33, -17, -48, -40, 4, 5, -22, -39, -79, -125, -111, -72, -68, -67, -50, -42, -33, -14, -30, -94, -140, -104, -15, 42, 26, 10, 70, 157, 221, 315, 445, 542, 627, 785, 982, 1103, 1123, 1098, 1046, 952, 818, 634, 419, 241, 124, 40, -8, -17, -26, -39, -27, -11, -24, -26, 12, 26, -14, -34, -9, 12, 7, -25, -69, -72, -33, -6, -1, -17, -50, -63, -43, -30, -38, -14, 49, 63, 8, -40, -44, -20, 20, 48, 27, -34, -65, -43, -35, -68, -80, -44, -9, -9, -13, 11, 28, 18, 22, 41, 8, -71, -99, -54, 1, 20, 2, -26, -37, -21, -6, -22, -60, -103, -125, -93, -36, -20, -45, -61, -47, -12, 20, 16, -18, -20, 3, -18, -55, -41, -13, -12, -13, -11, -26, -36, -33, -35, -37, -42, -62, -67, -31, 8, 11, -3, -32, -87, -112, -69, -45, -98, -140, -112, -75, -70, -68, -56, -47, -41, -35, -39, -64, -81, -57, -12, 8, 5, -8, -34, -60, -39, 8, -5, -65, -58, 9, 31, -4, -33, -40, -46, -64, -70, -41, -4, -2, -30, -50, -32, 25, 79, 85, 39, -7, -2, 22, 10, -14, 1, 41, 66, 68, 63, 39, 2, 0, 28, 39, 14, -24, -29, 7, 33, 28, 23, 12, -21, -22, 34, 72, 65, 57, 48, 7, -45, -77, -82, -51, 7, 41, 24, 3, 8, 20, 20, 9, 3, 5, -8, -32, -36, -13, -3, -5, 21, 45, 15, -10, 14, 24, -16, -47, -22, 36, 70, 46, -10, -46, -41, -15, 1, 2, 1, -13, -49, -86, -65, 19, 75, 39, -17, -18, 1, -2, -10, -17, -28, -16, 6, -11, -40, -18, 11, -8, -30, -12, 6, 1, 17, 67, 98, 75, 26, 14, 50, 74, 52, 22, 9, -2, -13, -4, 11, 17, 26, 37, 9, -45, -46, -7, 1, -6, 18, 44, 37, 31, 60, 80, 51, 15, 2, -4, -3, 9, 30, 48, 45, 60, 115, 145, 116, 101, 125, 131, 110, 103, 105, 91, 74, 68, 74, 105, 144, 149, 119, 89, 102, 152, 171, 142, 117, 122, 123, 102, 95, 105, 89, 45, 11, -9, -7, 18, 35, 39, 57, 83, 69, 22, -7, -22, -39, -46, -57, -67, -33, 5, -6, -18, 7, 25, 2, -27, -31, -17, 3, 8, -9, -18, -3, 6, -27, -68, -65, -24, 9, 7, -13, -12, 5, 13, 14, 3, -35, -67, -59, -48, -50, -5, 61, 35, -35, -10, 79, 151, 241, 375, 511, 646, 803, 959, 1076, 1133, 1129, 1091, 1034, 923, 737, 533, 361, 205, 71, 21, 37, 7, -75, -99, -54, -41, -76, -86, -49, -9, 7, -10, -56, -89, -83, -53, -22, -32, -90, -128, -96, -41, -24, -38, -47, -36, -23, -34, -61, -71, -69, -77, -68, -46, -48, -60, -56, -53, -58, -45, -28, -34, -47, -64, -103, -117, -60, -13, -35, -50, -10, 16, -12, -52, -76, -82, -50, -9, -27, -69, -74, -82, -101, -81, -60, -68, -62, -53, -75, -75, -11, 35, 11, -28, -43, -42, -17, 7, -24, -70, -59, -5, 31, 11, -61, -130, -137, -108, -109, -126, -104, -67, -69, -96, -108, -97, -89, -94, -84, -66, -78, -97, -81, -66, -92, -107, -73, -46, -69, -111, -148, -156, -101, -34, -37, -85, -105, -97, -85, -58, -34, -55, -105, -122, -99, -81, -81, -80, -81, -85, -69, -33, -12, -23, -38, -36, -31, -37, -14, 39, 40, -13, -32, -14, -18, -32, -22, -5, 8, 37, 56, 26, -9, 0, 18, -4, -35, -42, -43, -38, -20, -18, -21, -10, -24, -61, -63, -33, -9, 16, 32, 12, -16, -26, -37, -49, -48, -67, -98, -70, 0, 12, -24, -33, -31, -46, -56, -77, -115, -117, -84, -89, -131, -110, -27, 6, -39, -84, -82, -46, -29, -65, -102, -85, -45, -20, -29, -65, -78, -59, -66, -86, -61, -30, -54, -79, -43, -9, -23, -33, -20, -28, -58, -75, -59, -20, -5, -44, -85, -71, -37, -23, -4, 22, 11, -17, -19, -24, -34, 0, 38, 16, -27, -33, -33, -50, -55, -59, -81, -75, -28, 9, 9, -22, -64, -74, -48, -37, -45, -31, -4, -9, -35, -58, -96, -117, -59, 22, 24, -18, -27, -25, -32, -11, 10, -33, -87, -64, 1, 17, -23, -53, -43, -23, -12, 3, 30, 36, 5, -4, 34, 61, 66, 86, 96, 63, 22, 11, 25, 53, 72, 55, 32, 40, 57, 60, 60, 58, 42, 33, 37, 10, -30, -19, 9, -17, -62, -83, -92, -71, -16, 21, 16, -7, -35, -51, -56, -77, -105, -104, -95, -94, -56, 17, 30, -27, -69, -85, -119, -148, -143, -124, -95, -57, -49, -65, -58, -34, -25, -37, -66, -108, -119, -68, -16, -38, -107, -146, -153, -151, -121, -74, -47, -40, -21, 45, 169, 298, 388, 476, 609, 777, 949, 1069, 1071, 990, 915, 848, 743, 592, 405, 216, 78, -2, -44, -57, -54, -55, -63, -53, -30, -36, -64, -53, -23, -47, -99, -113, -105, -91, -75, -84, -114, -112, -63, -11, -12, -58, -95, -98, -95, -117, -146, -141, -108, -79, -73, -95, -127, -122, -80, -56, -72, -84, -69, -60, -61, -49, -39, -54, -71, -81, -104, -106, -79, -89, -138, -149, -98, -52, -60, -83, -69, -57, -104, -157, -138, -78, -44, -44, -63, -85, -87, -71, -56, -41, -39, -85, -153, -157, -96, -52, -44, -45, -60, -77, -73, -76, -98, -80, -27, -24, -71, -95, -101, -125, -138, -134, -139, -134, -109, -96, -94, -74, -56, -64, -70, -65, -73, -80, -64, -53, -78, -124, -148, -140, -128, -120, -105, -95, -95, -88, -85, -113, -150, -139, -90, -76, -109, -120, -86, -62, -60, -55, -44, -31, -34, -86, -139, -116, -58, -56, -106, -124, -76, -22, -14, -21, -18, -18, -24, -27, -14, 8, -2, -44, -48, -4, 20, 4, -12, -17, -32, -67, -96, -78, -14, 34, 26, -7, -49, -99, -114, -71, -27, -18, -20, -28, -51, -49, -6, 19, -5, -21, -17, -35, -60, -41, -11, -14, -26, -30, -33, -42, -73, -111, -113, -98, -106, -106, -70, -42, -45, -41, -28, -31, -41, -43, -54, -71, -66, -48, -39, -33, -30, -50, -85, -111, -117, -89, -37, -3, -5, -14, -15, -32, -56, -52, -33, -34, -42, -36, -23, -10, 6, 12, -4, -26, -36, -29, -21, -44, -78, -60, -7, 16, 14, 19, 17, 14, 19, -7, -50, -52, -40, -49, -30, 14, 6, -40, -36, 4, 15, 13, 20, 8, -19, -32, -31, -15, 8, 18, 8, 7, 42, 92, 91, 6, -88, -90, -20, 10, -25, -40, -12, 23, 56, 59, 13, -13, 21, 36, 12, 28, 61, 39, 22, 62, 88, 72, 51, 34, 40, 88, 117, 86, 58, 62, 64, 82, 114, 111, 84, 91, 121, 114, 70, 19, -38, -68, -37, -3, -9, -17, -6, 1, 9, 27, 9, -60, -97, -54, 7, 0, -76, -120, -83, -40, -32, -14, 13, 10, -6, -8, -20, -47, -62, -63, -65, -45, 13, 53, 30, -8, -21, -29, -17, 16, -1, -62, -70, -22, -7, -32, -43, -46, -75, -102, -61, 35, 103, 139, 225, 381, 541, 673, 792, 893, 965, 1022, 1058, 1039, 957, 845, 684, 464, 274, 159, 63, -12, -31, -48, -87, -92, -63, -33, -3, 13, 0, -23, -38, -43, -48, -43, -35, -42, -56, -71, -100, -118, -100, -65, -33, -32, -76, -101, -57, -18, -36, -38, 8, 36, 33, 35, 11, -55, -83, -49, -37, -70, -83, -35, 32, 29, -52, -116, -108, -68, -35, -23, -38, -60, -50, -16, -2, -4, -2, -29, -83, -84, -33, -14, -24, -18, -13, -29, -53, -68, -50, -8, 1, -40, -71, -51, -14, -12, -58, -109, -109, -60, -23, -34, -51, -49, -53, -61, -66, -77, -63, -17, -9, -45, -51, -27, -36, -66, -62, -30, -35, -72, -83, -75, -74, -72, -69, -72, -70, -72, -88, -106, -123, -126, -82, -21, -19, -61, -62, -34, -46, -81, -89, -76, -61, -40, -18, -10, -24, -38, -50, -63, -49, 2, 26, 0, -19, -1, 13, -12, -32, -14, 3, -1, 3, 30, 49, 38, 23, 13, -9, -19, -5, -1, 5, 44, 70, 39, 9, 15, 17, -1, -28, -66, -81, -31, 34, 39, -3, -33, -28, -10, -13, -42, -50, -5, 58, 81, 59, 13, -29, -29, -1, 2, 7, 46, 66, 34, -1, -22, -62, -84, -37, 27, 46, 29, -22, -86, -96, -60, -68, -107, -81, -13, -7, -57, -70, -24, 24, 18, -12, -1, 28, 22, 13, 45, 72, 51, 16, 2, -5, -4, -1, -29, -46, 0, 19, -40, -47, 33, 49, -7, -20, 3, 2, -17, -49, -81, -59, 6, 19, -20, -34, -20, 6, 48, 40, -31, -54, -6, 21, 17, 36, 68, 83, 104, 118, 84, 5, -90, -145, -99, 7, 58, 32, 12, 16, 11, 7, 3, -19, -31, -14, -14, -34, -36, -37, -39, 6, 70, 83, 79, 100, 103, 84, 81, 58, -7, -34, 24, 100, 132, 139, 141, 129, 113, 130, 168, 152, 76, 39, 63, 74, 66, 86, 99, 77, 96, 169, 183, 99, 31, 45, 53, 5, -39, -59, -66, -41, 11, 50, 60, 55, 39, 27, 38, 46, 10, -53, -89, -62, -4, 16, -15, -30, -34, -73, -101, -67, -23, -27, -48, -42, -31, -36, -32, -26, -29, -17, -8, -42, -79, -62, -35, -46, -63, -51, -32, -26, -20, -14, -17, -38, -50, -18, 26, 36, 41, 78, 136, 214, 351, 533, 688, 795, 919, 1064, 1125, 1073, 989, 906, 801, 646, 435, 237, 116, 55, 31, 36, 25, -11, -32, -42, -72, -78, -17, 22, -29, -90, -101, -82, -36, 9, -21, -91, -93, -51, -51, -58, -43, -58, -84, -52, -23, -69, -123, -110, -59, -27, -43, -83, -85, -55, -58, -88, -81, -32, 0, -21, -67, -83, -66, -63, -88, -104, -94, -79, -57, -30, -35, -72, -84, -57, -39, -51, -72, -79, -70, -56, -54, -70, -74, -36, 6, -5, -49, -67, -73, -86, -68, -22, -14, -39, -38, -6, 3, -26, -58, -87, -114, -104, -56, -28, -58, -102, -87, -28, -2, -24, -31, -1, 19, -25, -106, -136, -102, -90, -130, -148, -122, -95, -63, -33, -53, -99, -121, -125, -113, -74, -56, -91, -118, -106, -116, -135, -90, -19, -27, -85, -104, -89, -78, -68, -55, -45, -31, -22, -36, -56, -62, -68, -71, -53, -42, -32, 4, 24, -5, -28, -21, -19, -32, -31, -20, -27, -30, -22, -40, -73, -66, -16, 27, 25, 8, 29, 54, 27, -8, -4, -15, -57, -56, -2, 21, -8, -30, -8, 34, 48, 34, 17, 7, 8, 6, -26, -64, -61, -32, -33, -81, -131, -134, -84, -18, 5, -21, -44, -45, -34, -13, -3, -22, -46, -53, -49, -43, -38, -37, -44, -54, -53, -27, -12, -55, -103, -80, -37, -54, -85, -60, -26, -24, -7, 21, 6, -29, -40, -31, -10, -13, -57, -70, -21, 10, -9, -19, 6, 28, 19, -12, -43, -42, -12, -1, -6, 9, -5, -60, -61, 5, 25, -22, -51, -38, -15, 7, 5, -50, -96, -67, -18, -16, -33, -28, -8, 11, 14, 3, 1, 18, 13, -28, -43, -24, -17, -9, 11, 8, -20, -19, 20, 39, 14, -20, -25, -15, -16, -19, -19, -34, -59, -47, 11, 59, 72, 94, 138, 160, 148, 129, 110, 73, 29, 12, 38, 83, 101, 91, 81, 65, 52, 80, 112, 80, 30, 46, 80, 39, -24, -5, 58, 55, -1, -31, -22, -18, -37, -46, -22, -6, -34, -61, -51, -38, -39, -26, -16, -24, -21, -33, -59, -30, 37, 38, -14, -23, -6, -54, -146, -187, -161, -100, -24, 19, -6, -35, -37, -58, -91, -97, -112, -152, -143, -55, 18, 14, -13, -16, -10, 3, 23, 37, 76, 179, 326, 475, 617, 765, 931, 1084, 1139, 1090, 1040, 1014, 940, 774, 534, 287, 116, 44, -6, -62, -77, -72, -91, -106, -103, -119, -122, -67, -21, -22, -14, 5, -13, -31, -21, -41, -88, -89, -57, -50, -57, -50, -36, -33, -51, -72, -40, 5, -45, -137, -142, -83, -53, -50, -51, -64, -84, -102, -101, -69, -42, -60, -86, -71, -45, -54, -66, -50, -43, -51, -47, -49, -77, -84, -58, -51, -74, -96, -108, -102, -61, -18, -8, -12, -19, -38, -42, -16, -7, -32, -67, -102, -131, -115, -56, -29, -50, -81, -107, -110, -99, -101, -95, -64, -42, -45, -42, -39, -59, -73, -63, -59, -71, -82, -93, -107, -101, -81, -67, -50, -45, -87, -122, -81, -27, -49, -94, -86, -59, -57, -54, -39, -52, -92, -121, -133, -134, -121, -92, -64, -68, -99, -97, -47, -22, -63, -111, -96, -58, -68, -96, -78, -44, -40, -43, -30, -8, 10, -7, -42, -43, -25, -30, -16, 25, 22, -26, -37, 4, 32, 5, -39, -30, 18, 36, -4, -54, -57, -24, -5, -16, -34, -40, -28, -16, -41, -65, -22, 31, 26, 5, 12, 24, 18, -4, -10, 15, 7, -59, -103, -70, -19, -9, -20, -20, -24, -38, -42, -37, -31, -27, -46, -86, -94, -64, -60, -79, -71, -64, -82, -82, -58, -45, -40, -35, -40, -48, -50, -60, -64, -40, -36, -65, -64, -30, -20, -27, -19, -9, 1, 20, 13, -24, -49, -56, -72, -66, -16, 12, -17, -48, -56, -80, -106, -101, -94, -91, -69, -47, -45, -31, 4, 19, 0, -16, -19, -18, -11, -10, -12, 4, 4, -21, -35, -34, -25, -3, 1, -23, -29, -18, -30, -26, 33, 79, 45, -18, -29, 2, 8, -20, -37, -38, -43, -29, 12, 28, 12, 6, 10, 4, -7, -10, 16, 77, 118, 102, 70, 66, 76, 72, 66, 83, 115, 110, 62, 49, 95, 114, 80, 70, 84, 75, 84, 109, 68, -19, -57, -56, -73, -88, -71, -55, -58, -64, -57, -47, -49, -69, -77, -45, -15, -32, -55, -51, -47, -39, -20, -28, -61, -62, -40, -47, -67, -69, -72, -93, -101, -91, -76, -65, -69, -80, -44, 10, -21, -93, -73, -2, 6, -21, -20, -32, -86, -123, -98, -61, -67, -89, -45, 72, 179, 244, 312, 416, 560, 733, 898, 1010, 1063, 1067, 1033, 937, 782, 621, 458, 292, 158, 45, -59, -92, -51, -26, -50, -84, -111, -118, -89, -47, -32, -53, -85, -91, -70, -76, -133, -172, -139, -98, -110, -128, -112, -105, -119, -126, -132, -135, -115, -110, -139, -127, -64, -39, -66, -82, -75, -77, -81, -74, -52, -31, -51, -107, -150, -164, -160, -137, -103, -93, -92, -64, -44, -81, -115, -89, -76, -126, -159, -121, -74, -64, -81, -102, -112, -109, -95, -71, -49, -48, -62, -66, -54, -51, -77, -130, -181, -179, -139, -121, -116, -89, -79, -121, -151, -134, -126, -130, -108, -109, -170, -186, -96, -6, -6, -58, -99, -104, -98, -129, -180, -207, -197, -163, -106, -56, -81, -155, -173, -146, -141, -135, -110, -111, -136, -154, -153, -135, -125, -148, -181, -186, -169, -143, -98, -49, -32, -48, -69, -94, -111, -102, -107, -155, -171, -110, -49, -36, -47, -73, -99, -85, -44, -48, -82, -69, -23, -13, -25, -23, -31, -53, -58, -53, -73, -105, -107, -77, -57, -70, -93, -88, -75, -72, -56, -35, -46, -55, -18, 2, -52, -105, -97, -72, -74, -100, -136, -155, -135, -104, -94, -103, -125, -144, -141, -135, -144, -136, -98, -87, -127, -150, -124, -110, -113, -90, -72, -94, -130, -138, -102, -66, -89, -130, -110, -63, -61, -78, -80, -113, -156, -135, -98, -113, -115, -83, -107, -156, -113, -38, -49, -87, -78, -68, -81, -88, -99, -109, -85, -74, -105, -114, -74, -42, -36, -47, -85, -119, -108, -93, -112, -115, -87, -98, -135, -117, -62, -48, -83, -114, -110, -88, -89, -109, -97, -60, -61, -87, -65, 0, 36, 1, -77, -132, -115, -66, -83, -144, -154, -129, -124, -101, -71, -93, -109, -49, 0, -31, -56, -18, 18, 4, -30, -43, -26, 2, 24, 41, 40, -4, -56, -69, -50, -22, 5, 31, 48, 52, 38, 10, -4, 12, 9, -44, -90, -96, -104, -117, -101, -83, -95, -97, -67, -63, -95, -90, -44, -29, -57, -103, -162, -209, -199, -150, -125, -129, -133, -133, -142, -172, -194, -159, -96, -76, -94, -103, -114, -145, -149, -119, -121, -159, -160, -117, -91, -122, -176, -183, -146, -148, -193, -211, -190, -159, -142, -142, -138, -105, -29, 69, 154, 248, 370, 489, 599, 734, 880, 981, 1022, 984, 859, 719, 596, 431, 230, 75, -19, -91, -141, -163, -172, -163, -140, -127, -122, -112, -111, -115, -105, -125, -199, -240, -204, -166, -166, -167, -163, -164, -163, -176, -190, -159, -121, -149, -190, -158, -117, -138, -154, -114, -72, -72, -100, -143, -188, -208, -198, -192, -208, -222, -212, -189, -170, -155, -124, -83, -82, -116, -127, -113, -98, -71, -60, -103, -158, -173, -200, -252, -239, -187, -207, -253, -221, -153, -141, -173, -185, -163, -151, -168, -175, -139, -114, -141, -156, -119, -107, -154, -185, -158, -124, -119, -135, -164, -186, -170, -137, -134, -141, -140, -166, -210, -224, -210, -183, -152, -164, -227, -263, -244, -210, -171, -140, -151, -170, -158, -145, -153, -155, -163, -204, -238, -213, -162, -148, -155, -151, -151, -176, -218, -239, -214, -175, -159, -142, -104, -95, -137, -171, -180, -189, -177, -160, -185, -210, -178, -132, -131, -144, -138, -132, -131, -113, -87, -80, -91, -113, -133, -134, -124, -121, -106, -91, -106, -127, -124, -115, -115, -111, -113, -149]
    data = [i+random.randint(-100, 250) for i in data]
    data = [data for j in range(12)]
    return make_response(jsonify({'data': data}), 200)

@app.route('/anno/<int:index>', methods=['GET', 'POST'])
def anno(index):
    form = request.form
    if form:
        print(form)

    data = [
        {'group_label': "Ритм сердца",
          'group_data': [{"view": "checkbox", "label": "(N)Нормальный ритм", "value": 0, "name": "one"},
                         {"view": "checkbox", "label": "Синусовая тахикардия", "value": 0, "name": "two"},
                         {"view": "checkbox", "label": "Синусовая брадикардия", "value": 0, "name": "three"},
                         {"view": "checkbox", "label": "Синусовая аритмия", "value": 0, "name": "four"},
                         {"view": "checkbox", "label": "Экстрасистолия", "value": 0, "name": "five"},
                         {"view": "checkbox", "label": "Синусовая аритмия", "value": 0, "name": "six"},
                         {"view": "checkbox", "label": "Трепетание предсердий", "value": 0, "name": "seven"},
                         {"view": "checkbox", "label": "Фибрилляция предсердий", "value": 0, "name": "eight"},
                         {"view": "checkbox", "label": "Трепетание и фибрилляция желудочков", "value": 0, "name": "nine"}

                         ]},
        {'group_label': "Нарушения функции проводимости",
          'group_data': [{"view": "checkbox", "label": "Атриовентрикулярная блокада I", "value": 0, "name": "one"},
                         {"view": "checkbox", "label": "Атриовентрикулярная блокада II", "value": 0, "name": "two"},
                         {"view": "checkbox", "label": "Атриовентрикулярная блокада III", "value": 0, "name": "three"},
                         {"view": "checkbox", "label": "(БЛНПГ)Блокада левой ножки пучка Гиса", "value": 0, "name": "three"},
                         {"view": "checkbox", "label": "(НБЛНПГ)Неполная блокада левой ножки пучка Гиса", "value": 0,
                          "name": "three"},
                         {"view": "checkbox", "label": "(ПБПНПГ)Полная блокада правой ножки пучка Гиса", "value": 0, "name": "three"},
                         {"view": "checkbox", "label": "(НБПНПГ)Неполная блокада правой ножки пучка Гиса", "value": 0,
                          "name": "three"}
                         ]},
        {'group_label': "Другие Показатели",
          'group_data': [{"view": "checkbox", "label": "Гипертрофия левого желудочка", "value": 1, "name": "one"},
                         {"view": "checkbox", "label": "Гипертрофия правого желудочка", "value": 1, "name": "two"},
                         {"view": "checkbox", "label": "Гипертрофия левого предсердия", "value": 0, "name": "three"},
                         {"view": "checkbox", "label": "Гипертрофия правого предсердия", "value": 0, "name": "three"},
                         {"view": "checkbox", "label": "Ишемия миокарда", "value": 0, "name": "three"},
                         {"view": "checkbox", "label": "Инфаркт миокарда", "value": 0, "name": "three"},
                         ]}

    ]
    return make_response(jsonify({'data': data}), 200)



if __name__ == '__main__':
    app.run(debug=True)