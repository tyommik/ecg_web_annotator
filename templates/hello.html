<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="static/css/bootstrap.min.css">
    <link rel="stylesheet" href="static/css/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="/static/js/canvasjs.min.js"></script>

    <link rel="stylesheet" href="//cdn.webix.com/edge/webix.css" type="text/css">
    <script src="//cdn.webix.com/edge/webix.js" type="text/javascript"></script>

    <style>
        {
            box-sizing: border-box
        ;
        }
        /* Set additional styling options for the columns */
        .column {
            float: left;
            height: 400px;
        }

        /* Set width length for the left, right and middle columns */
        .left {
            width: 30%;
        }

        .middle {
            width: 30%;
        }

        .right {
            width: 30%;
        }

        .row:after {
            content: "";
            display: table;
            clear: both;
        }

        .wrapper {
            text-align: center;
        }

        .button {
            position: absolute;
            top: 50%;
        }
    </style>
</head>
<body>

<div class="main-container">
    <div class="viewer_layout">
        <div class="viewer" id="viewer_container">
<!--            <div id="chartContainer" style="height: 300px; width: 100%;"></div>-->
        </div>
        <div class="viewer-panel" id="areaA">panel</div>
    </div>
    <div class="ecg-list">
        <div class="list" id="ecglist"></div>
        <div class="list-panel">list-panel</div>
    </div>
</div>

<!--<form method="post">-->
<!--    {{ form.hidden_tag() }}-->
<!--    <div class="jumbotron text-center">-->
<!--        <p>{{ info }}</p>-->
<!--        <div class="container">-->
<!--            &lt;!&ndash;               <img src="data:image/png;base64,{{ image }}"/>&ndash;&gt;-->
<!--            <div id="chartContainer" style="height: 300px; width: 100%;"></div>-->
<!--            <div id="main" style="height: 500px; width: 100%;"></div>-->
<!--        </div>-->
<!--        <h1>Диагноз</h1>-->
<!--        <p>{{ diagnosis }}</p>-->
<!--    </div>-->
<!--    <div class="container">-->
<!--        <div class="row">-->
<!--            <div class="col-sm-4">-->
<!--                <h3>Ритм</h3>-->
<!--                {{ form.norma }}-->
<!--                {{ form.rhythm }}-->
<!--            </div>-->
<!--            <div class="col-sm-4">-->
<!--                <h3>Нарущение функции проводимости</h3>-->
<!--                {{ form.blocks }}-->
<!--            </div>-->
<!--            <div class="col-sm-4">-->
<!--                <h3>Гипертрофии</h3>-->
<!--                {{ form.hypertrophy }}-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--    <div class="wrapper">-->
<!--        <button type="submit">Отправить</button>-->
<!--    </div>-->
<!--</form>-->
<!--</body>-->

<script type="text/javascript" charset="utf-8">
    function sendRequest(method, url) {
        return fetch(url).then(response => {
            return response.json()
        })
    }

    var formdata = new FormData()
    var form1 = [
        {
            view: "checkbox", label: "First age", on: {
                onChange: function () {
                    console.log(this.getValue())
                }
            }
        },
        {view: "checkbox", label: "Second age", value: true},
        {view: "checkbox", labelRight: "Third age"},
        {
            cols: [
                {view: "checkbox", label: "val A", labelWidth: 50},
                {
                    view: "checkbox", label: "val B", labelWidth: 50, value: 1,
                    uncheckValue: "off", checkValue: "on"
                },
                {view: "checkbox", label: "val C", labelWidth: 50}
            ]
        }
    ];

    sendRequest('GET', '/anno/100').then(result => {
        console.log(result)
    });

    webix.ready(() => {
        webix.ui(
            {
                container: "ecglist",
                rows: [
                    // {template: "header", height: 1},
                    {
                        cols: [
                            {
                                header: "List files", body:
                                    {
                                        view: "list",
                                        // width: 100%,
                                        template: "#rank#. #title#",
                                        // data: big_film_set,
                                        url: "/getlist",
                                        select: true,
                                        // onClick:{
                                        //     info:function(e, id){
                                        //         webix.message(this.getItem(id).title);
                                        //         return false;
                                        //     }
                                        // },
                                        on: {
                                            // the default click behavior that is true for any datatable cell
                                            "onItemClick": function (id, e, trg) {
                                                const requestURL = '/leads/100'
                                                sendRequest('GET', requestURL)
                                                    .then(d => {
                                                        drawLeads({"test": "here"}, d)
                                                    })
                                                    .catch(err => {
                                                            console.log(err)
                                                        }
                                                    )
                                            }
                                        },
                                    }
                            },

                            // {},
                            // {view: "resizer"},
                            //
                            // {
                            //     header: "List files", body:
                            //         {
                            //             view: "list",
                            //             width: 320,
                            //             template: "#rank#. #title#",
                            //             data: big_film_set
                            //         }
                            // }
                        ]
                    },
                    // {template: "footer", height: 50}
                ]
            }
        );

    })

    webix.ready(() => {
        webix.ui(
            {
                container: "areaA",
                id: "formA",
                url: "/anno",
                margin: 30, cols: [
                    {
                        view: "form",
                        scroll: false,
                        elements: form2,
                        id:"form_tipos",
                    },
                    {
                        view: "button", value: "Confirm", width: 200, align: "center",
                        click: () => {
                            var form = $$("form_tipos");
                            var data = JSON.stringify(form1)
                            if (true) {
                            // if (form.validate()) {
                                webix.ajax().post("/anno/100", JSON.stringify(form1), function (res) {
                                    /*callback*/
                                });
                            }
                        }
                    }
                ]


            })
    });

</script>

<script>
    function sendRequest(method, url) {
        return fetch(url).then(response => {
            return response.json()
        })
    }

    function drawSingleLead(lead, containerName, singleLeadData) {
        var xAxisStripLinesArray = [];
        var yAxisStripLinesArray = [];
        var dps = [];
        var dataPointsArray = singleLeadData.data;

        var chart = new CanvasJS.Chart(containerName, {
            height: 200,
            zoomEnabled: true,
            animationEnabled: true,
            showInLegend: true,
            // title: {
            //     text: "ECG Report",
            // },
            subtitles: [{
                text: "Lead " + lead,
                horizontalAlign: "left",
            }],
            //     {
            //         text: "Age: X-Years",
            //         horizontalAlign: "left",
            //     },
            //     {
            //         text: "Doctor Sign",
            //         horizontalAlign: "right",
            //         verticalAlign: "bottom",
            //     },
            // ],
            axisY: {
                stripLines: yAxisStripLinesArray,
                gridThickness: 2,
                gridColor: "#DC74A5",
                lineColor: "#DC74A5",
                tickColor: "#DC74A5",
                labelFontColor: "#DC74A5",
            },
            axisX: {
                stripLines: xAxisStripLinesArray,
                gridThickness: 2,
                gridColor: "#DC74A5",
                lineColor: "#DC74A5",
                tickColor: "#DC74A5",
                labelFontColor: "#DC74A5",
            },
            data: [{
                type: "spline",
                color: "black",
                dataPoints: dps
            }]
        });

        addDataPointsAndStripLines();
        chart.render();

        function addDataPointsAndStripLines() {
            //dataPoints
            for (var i = 0; i < dataPointsArray.length; i++) {
                dps.push({
                    y: dataPointsArray[i]
                });
            }
            //StripLines
            for (var i = 0; i < 5000; i = i + 100) {
                // if (i % 1000 != 0)
                yAxisStripLinesArray.push({
                    value: i,
                    thickness: 0.7,
                    color: "#DC74A5"
                });
            }
            for (var i = 0; i < 5000; i += 20) {
                // if (i % 200 != 0)
                xAxisStripLinesArray.push({
                    value: i,
                    thickness: 0.7,
                    color: "#DC74A5"
                });
            }
        }
    }


    function drawLeads(params, data) {

        const myNode = document.getElementById("viewer_container");
        while (myNode.lastElementChild) {
            myNode.removeChild(myNode.lastElementChild);
        }

        for (let i=0; i < 4; i++) {
            var div = document.createElement('div')
            div.className = "chart"
            div.id = "chartContainer" + i
            div.style ="position: relative; width: 100%; height: 200px;display: inline-block;"
            document.getElementById('viewer_container').appendChild(div)
            drawSingleLead(i + 1, 'chartContainer' + i, data)
        }

    }

    const requestURL = '/leads/100'
    sendRequest('GET', requestURL)
        .then(d => {
            drawLeads({"test": "here"}, d)
        })
        .catch(err => {
                console.log(err)
            }
        )

</script>
</html>